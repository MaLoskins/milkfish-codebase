<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MilkFish Vizualizations - Parser Test</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #2d2d2d;
            border-radius: 8px;
        }
        .test-controls {
            margin-bottom: 20px;
        }
        .test-output {
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 500px;
            overflow-y: auto;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #e83e8c;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <h1>MilkFish Vizualizations - Parser Test</h1>
    </header>
    
    <main>
        <div class="test-container">
            <div class="test-controls">
                <button id="test-btn">Test Parser with Complex Python File</button>
                <div class="loader" id="loader"></div>
            </div>
            <div class="test-output" id="output">
                Click the button to test the parser with a complex Python file.
            </div>
        </div>
    </main>
    
    <script src="js/parser.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const testBtn = document.getElementById('test-btn');
            const output = document.getElementById('output');
            const loader = document.getElementById('loader');
            
            testBtn.addEventListener('click', async function() {
                loader.style.display = 'block';
                output.textContent = 'Testing parser...';
                
                try {
                    // Python code embedded directly to avoid CORS issues
                    const pythonCode = `import os
import sys
from datetime import datetime, timedelta
from typing import List, Dict, Optional, Union, Any

# Decorator example
def log_execution(func):
    def wrapper(*args, **kwargs):
        print(f"Executing {func.__name__}")
        result = func(*args, **kwargs)
        print(f"Finished {func.__name__}")
        return result
    return wrapper

# Class with inheritance and nested methods
class BaseModel:
    """Base model class with common functionality"""
    
    def __init__(self, id: int = None):
        self.id = id or 0
        self.created_at = datetime.now()
    
    def to_dict(self) -> Dict[str, Any]:
        """Convert model to dictionary"""
        return {
            "id": self.id,
            "created_at": self.created_at.isoformat()
        }
    
    @classmethod
    def from_dict(cls, data: Dict[str, Any]) -> 'BaseModel':
        """Create model from dictionary"""
        instance = cls(id=data.get("id"))
        if "created_at" in data:
            instance.created_at = datetime.fromisoformat(data["created_at"])
        return instance

# Multiple inheritance
class Loggable:
    def log(self, message: str) -> None:
        print(f"[{datetime.now()}] {message}")

# Class with decorators, multiline methods, and complex inheritance
class User(BaseModel, Loggable):
    """User model with extended functionality"""
    
    def __init__(self, username: str, email: str, id: int = None):
        super().__init__(id)
        self.username = username
        self.email = email
        self.posts = []
        self.log(f"Created user {username}")
    
    @log_execution
    def add_post(self, post: 'Post') -> 'Post':
        """
        Add a post to user's posts list
        This is a multiline docstring
        that spans several lines
        """
        self.posts.append(post)
        self.log(f"Added post {post.title} to user {self.username}")
        return post
    
    def get_posts(self) -> List['Post']:
        """Get all posts by this user"""
        return self.posts`;
                    
                    const mockFile = {
                        name: 'test_complex.py',
                        webkitRelativePath: 'test_complex.py'
                    };
                    
                    // Override the readFile method to use our embedded code
                    pythonParser.readFile = function() {
                        return Promise.resolve(pythonCode);
                    };
                    
                    // Parse the file
                    const result = await pythonParser.parseFiles([mockFile]);
                    
                    // Display the result
                    output.textContent = JSON.stringify(result, null, 2);
                    
                    // Log the result to console for inspection
                    console.log('Parser result:', result);
                } catch (error) {
                    output.textContent = `Error: ${error.message}\n\n${error.stack}`;
                    console.error('Parser test error:', error);
                } finally {
                    loader.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>